@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.AspNetCore.Components.Web
@using Oqtane.Modules
@using Oqtane.Models
@using Oqtane.Services
@namespace Oqtane.Modules.Admin.Register
@inherits ModuleBase
@inject NavigationManager NavigationManager
@inject IUserService UserService

<div class="container">
    <div class="form-group">
        <label for="Username" class="control-label">Email: </label>
        <input type="text" name="Username" class="form-control" placeholder="Username" @bind="@Email" />
    </div>
    <div class="form-group">
        <label for="Password" class="control-label">Password: </label>
        <input type="password" name="Password" class="form-control" placeholder="Password" @bind="@Password" />
    </div>
    <button type="button" class="btn btn-primary" @onclick="RegisterUser">Register</button>
    <button type="button" class="btn btn-secondary" @onclick="Cancel">Cancel</button>
</div>

@code {
    public override SecurityAccessLevel SecurityAccessLevel { get { return SecurityAccessLevel.Anonymous; } }

    public string Email { get; set; } = "";
    public string Password { get; set; } = "";

    private async Task RegisterUser()
    {
        User user = new User();
        user.SiteId = PageState.Site.SiteId;
        user.Username = Email;
        user.DisplayName = Email;
        user.Email = Email;
        user.IsHost = false;
        user.Password = Password;
        await UserService.AddUserAsync(user);
        NavigationManager.NavigateTo("");
    }

    private void Cancel()
    {
        NavigationManager.NavigateTo(NavigateUrl("")); // navigate to home
    }
}
